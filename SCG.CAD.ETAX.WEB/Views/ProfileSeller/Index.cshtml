@{
    ViewData["Title"] = "Document Code Profile";
    Layout = null;
}


@await Html.PartialAsync("~/Views/ProfileSeller/_Content.cshtml")


<script type="text/javascript">

         $(document).ready(function () {

            RenderProfileSeller();

             $('#toggleUpdateProfileSeller').change(function() {
                $('#toggleUpdateProfileSeller-event').html('Toggle: ' + $(this).prop('checked'))
            });

            $("#ddlInsertProfileSellerProvince").change(function () {

                alert("1123");

            });

        });

        $(window).on('load', function() {

            $('#modalCreateProfileSeller').select2({
                dropdownParent: $('#modalCreateProfileSeller')
            });


            $('#modalUpdateProfileSeller').select2({
                dropdownParent: $('#modalCreateProfileSeller')
            });


        });


        function getval(sel)
    {
        alert(sel.value);
    }


        function RenderProfileSeller(){

            var table = $("#tbProfileSellerMain").DataTable({

                "scrollY": false,
                "processing": true, // for show progress bar
                "serverSide": false, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": true, // for disable multiple column at once
                "pageLength": 10,

                "ajax": {
                    url: "@Url.Action("List", "ProfileSeller")",
                    type: "POST",
                    datatype: "json"
                },


                "columns": [

                    {
                        data: "sellerNo",
                        className: "text-center",
                        width: "5%",
                        visible: false
                    },
                    {
                        //data: "productUnitNo",
                        className: "text-center",
                        width: "5%",
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        data: "companyCode",
                        width: "20%"
                    },
                    {
                        data: "branchCode",
                        width: "20%"
                    },
                    {
                        data: "addressnumber",
                        width: "10%"
                    },
                    {
                        data: "sellerEmail",
                        width: "10%"
                    },
                    {
                        data: "isactive",
                        width: "10%",
                        className: "text-center",
                        render: function (data, type, row) {
                            return (data == 1) ? '<i class="text-success fas fa-check"/>' : '<i class="text-danger fas fa-ban"/>';
                        }
                    },
                    {
                        data: null,
                        className: "dt-center editor-edit text-center text-primary",
                        defaultContent: '<i class="pointer fas fa-pen"/>',
                        orderable: false,
                        width: "2%"
                    }
                    //{
                    //    data: null,
                    //    className: "dt-center editor-delete text-center text-danger",
                    //    defaultContent: '<i class="pointer fas fa-trash"/>',
                    //    orderable: false,
                    //    width: "2%"
                    //}
                ]
            });

            table.on( 'order.dt search.dt', function () {
                table.column(1, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                    cell.innerHTML = i+1;
                } );
            } ).draw();


            EditProfileSeller(table);
            DeleteProfileSeller(table);
        }

        function fnDropdownCompanyCode() {

            $('<option>',
            {
                value: 0,
            }).html("--- Select Company Code ---").appendTo("#ddlInsertProfileSellerCompanyCode");

            $.getJSON("@Url.Action("DropDownList", "ProfileCompany")", function (data) {
                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.companyCode,
                            text: data.companyCode
                        }).html(data.companyCode).appendTo("#ddlInsertProfileSellerCompanyCode");
                });

                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.companyCode,
                            text: data.companyCode
                        }).html(data.companyCode).appendTo("#ddlUpdateProfileSellerCompanyCode");
                });
            })

        }

        function fnDropdownProfileSellerProvince() {

            $('<option>',
            {
                value: 0,
            }).html("--- Select Provice ---").appendTo("#ddlInsertProfileSellerProvince");

            $.getJSON("@Url.Action("GetProvince", "ProfileSeller")", function (data) {
                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.proviceCode,
                            text: data.proviceName
                        }).html(data.proviceName).appendTo("#ddlInsertProfileSellerProvince");
                });

                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.proviceCode,
                            text: data.proviceName
                        }).html(data.proviceName).appendTo("#ddlUpdateProfileSellerProvince");
                });
            })
        }

        function fnDropdownProfileSellerDistrict() {

            var getproviceCode = "12";

            $('<option>',
            {
                value: 0,
            }).html("--- Select GetDistrict ---").appendTo("#ddlInsertProfileSellerDistrict");

            $.getJSON("@Url.Action("GetDistrict", "ProfileSeller")",{ proviceCode: getproviceCode }, function (data) {
                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.districtCode,
                            text: data.districtName
                        }).html(data.districtName).appendTo("#ddlInsertProfileSellerDistrict");
                });

                $.each(data, function (i, data) {
                    $('<option>',
                        {
                            value: data.districtCode,
                            text: data.districtName
                        }).html(data.districtName).appendTo("#ddlUpdateProfileSellerDistrict");
                });
            })
        }



        function fnInsertCancelProfileSeller(){

                $("#ddlInsertProfileSellerCompanyCode").empty();
                document.getElementById('txtInsertProfileSellerBranch').value = '';
                document.getElementById('txtInsertProfileSellerAddressNo').value = '';
                document.getElementById('txtInsertProfileSellerBuilding').value = '';
                $("#ddlInsertProfileSellerProvince").empty();
                $("#ddlInsertProfileSellerDistrict").empty();
                $("#ddlInsertProfileSellerSubDistrict").empty();
                document.getElementById('txtInsertProfileSellerEmail').value = '';
                $("#ddlInsertProfileSellerEmailTemplate").empty();

                $("#modalCreateProfileSeller").modal('hide');
        }

        function fnUpdateCancelProfileSeller(){

                $("#ddlUpdateProfileSellerCompanyCode").empty();
                document.getElementById('txtUpdateProfileSellerBranch').value = '';
                document.getElementById('txtUpdateProfileSellerAddressNo').value = '';
                document.getElementById('txtUpdateProfileSellerBuilding').value = '';
                $("#ddlUpdateProfileSellerProvince").empty();
                $("#ddlUpdateProfileSellerDistrict").empty();
                $("#ddlUpdateProfileSellerSubDistrict").empty();
                document.getElementById('txtUpdateProfileSellerEmail').value = '';
                $("#ddlUpdateProfileSellerEmailTemplate").empty();

                $("#modalUpdateProfileSeller").modal('hide');
        }

        function callModalInsertProfileSeller(){

            fnDropdownCompanyCode();
            fnDropdownProfileSellerProvince();

            $("#modalCreateProfileSeller").modal('show');

        }

        function fnInsertProfileSeller(){

            var GetCompanyCode = $('#ddlInsertProfileSellerCompanyCode').val();
            var GetProvince = $('#ddlInsertProfileSellerProvince').val();
            var GetDistrict = $('#ddlInsertProfileSellerDistrict').val();
            var GetSubDistrict = $('#ddlInsertProfileSellerSubDistrict').val();
            var GetEmailTemplate = $('#ddlInsertProfileSellerEmailTemplate').val();
            var GetBranchCode = $('#txtInsertProfileSellerBranch').val();

            if ( GetCompanyCode != '0' &&
            GetBranchCode != '' &&
            GetProvince != '0' &&
            GetDistrict != '0' &&
            GetSubDistrict != '0' &&
            GetEmailTemplate != '0')
            {
                callProfileSellerInsertController();
            }
            else {
                fnToastrInputDataFail();
                validateInsertProfileSeller();
            }

        }

        function fnUpdateProfileSeller(){

            var GetCompanyCode = $('#ddlUpdateProfileSellerCompanyCode').val();
            var GetProvince = $('#ddlUpdateProfileSellerProvince').val();
            var GetDistrict = $('#ddlUpdateProfileSellerDistrict').val();
            var GetSubDistrict = $('#ddlUpdateProfileSellerSubDistrict').val();
            var GetEmailTemplate = $('#ddlUpdateProfileSellerEmailTemplate').val();
            var GetBranchCode = $('#txtUpdateProfileSellerBranch').val();

            if ( GetCompanyCode != '0' &&
            GetBranchCode != '' &&
            GetProvince != '0' &&
            GetDistrict != '0' &&
            GetSubDistrict != '0' &&
            GetEmailTemplate != '0')
            {
                callProfileSellerUpdateController();
            }
            else {
                fnToastrInputDataFail();
                validateUpdateProfileSeller();
            }

        }

        function EditProfileSeller(table){

            $('#tbProfileSellerMain').on('click', 'td.editor-edit', function () {

                var data = table.row($(this).closest('tr')).data();

                var getPK = data[Object.keys(data)[0]];

                fnDropdownProfileSellerRd();

                callProfileSellerGetDetailController(getPK);

            });
        }

        function DeleteProfileSeller(table){

            $('#tbProfileSellerMain').on('click', 'td.editor-delete', function () {

                var data = table.row($(this).closest('tr')).data();

                var getPK = data[Object.keys(data)[0]];

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!',
                    confirmButtonClass: 'btn btn-primary',
                    cancelButtonClass: 'btn btn-danger ml-1',
                    buttonsStyling: false,
                    }).then(function (result) {
                        if (result) {
                            callProfileSellerDeleteController(getPK);
                            callProfileSellerIndex();
                          }
                        })
            });
        }

        function ExportProfileSeller(){

            $.blockUI();

            callProfileSellerExportController();

            $.unblockUI();
        }



        // [Begin] Ajax call Controller

        function callProfileSellerGetDetailController(getPK){
            $.ajax({
                type: "GET",
                url: "@Url.Action("Detail", "ProfileSeller")",
                data: { id : getPK },
                //contentType: 'application/json; charset=utf-8',
                dataType: "json",
                success: function (result) {

                    data = $.parseJSON(result)

                    document.getElementById('txtUpdateProfileSellerNo').value = data.SellerNo;
                    $("#ddlUpdateProfileSellerCompanyCode").select2("val", data.CompanyCode);
                    document.getElementById('txtUpdateProfileSellerBranch').value = data.BranchCode;
                    document.getElementById('txtUpdateProfileSellerAddressNo').value = data.Addressnumber;
                    document.getElementById('txtUpdateProfileSellerBuilding').value = data.Building;
                    document.getElementById('txtUpdateProfileSellerRoad').value = data.Building;
                    $("#ddlUpdateProfileSellerProvince").select2("val", data.Province);
                    $("#ddlUpdateProfileSellerDistrict").select2("val", data.District);
                    $("#ddlUpdateProfileSellerSubDistrict").select2("val", data.SubDistrict);
                    document.getElementById('txtUpdateProfileSellerEmail').value = data.SellerEmail;
                    $("#ddlUpdateProfileSellerEmailTemplate").select2("val", data.EmailTemplateNo);

                    if(data.Isactive == 1){
                        $('#toggleUpdateProfileSeller').bootstrapToggle('on');
                    }
                    else{
                        $('#toggleUpdateProfileSeller').bootstrapToggle('off');
                    }

                    $("#modalUpdateProfileSeller").modal('show');

                }
            });
        }

        function callProfileSellerInsertController(){

            var IsActive = 1;

            if($('#toggleInsertProfileSeller').prop('checked')){
                IsActive = 1;
            }
            else{
                IsActive = 0;
            }

            var model = new Object();

            model.CompanyCode = $('#ddlInsertProfileSellerCompanyCode').val();
            model.BranchCode = $('#txtInsertProfileSellerBranch').val();
            model.Province = $('#ddlInsertProfileSellerProvince').val();
            model.District = $('#ddlInsertProfileSellerDistrict').val();
            model.SubDistrict = $('#ddlInsertProfileSellerSubDistrict').val();
            model.Road = $('#txtInsertProfileSellerRoad').val();
            model.Building = $('#txtInsertProfileSellerBuilding').val();
            model.Addressnumber = $('#txtInsertProfileSellerAddressNo').val();
            model.SellerEmail = $('#txtInsertProfileSellerEmail').val();
            model.EmailTemplateNo = $('#ddlInsertProfileSellerEmailTemplate').val();
            model.CreateBy = $("#leftSideEmail").text();
            model.CreateDate = new Date();
            model.UpdateBy = $("#leftSideEmail").text();
            model.UpdateDate = new Date();
            model.Isactive = IsActive;

            var getJsonString = JSON.stringify(model);

            $.ajax({
                type: "POST",
                url: "@Url.Action("Insert", "ProfileSeller")",
                data: { jsonString : getJsonString },
                //contentType: 'application/json; charset=utf-8',
                dataType: "text",
                success: function (resp) {

                    JSON.parse(resp);

                    if(resp.status = true){

                        fnSweetAlert_SaveSuccess();

                        $("#ddlInsertProfileSellerCompanyCode").empty();
                        document.getElementById('txtInsertProfileSellerBranch').value = "";
                        document.getElementById('txtInsertProfileSellerAddressNo').value = "";
                        document.getElementById('txtInsertProfileSellerBuilding').value = "";
                        document.getElementById('txtInsertProfileSellerRoad').value = "";
                        $("#ddlInsertProfileSellerProvince").empty();
                        $("#ddlInsertProfileSellerDistrict").empty();
                        $("#ddlInsertProfileSellerSubDistrict").empty();
                        document.getElementById('txtInsertProfileSellerEmail').value = "";
                        $("#ddlInsertProfileSellerEmailTemplate").empty();

                        $("#modalCreateProfileSeller").modal('hide');

                        callProfileSellerIndex();
                    }
                    else{
                        fnSweetAlert_Error(resp.error_message);
                    }

                }
            });
        }

        function callProfileSellerUpdateController(){

            var IsActive = 1;

            var getToggle = $('#toggleUpdateProfileSeller-event').text();

            if(getToggle.includes("true")){
                IsActive = 1;
            }
            else
            {
                IsActive = 0;
            }

            var model = new Object();

            model.SellerNo = $('#txtUpdateProfileSellerNo').val();
            model.CompanyCode = $('#ddlUpdateProfileSellerCompanyCode').val();
            model.BranchCode = $('#txtUpdateProfileSellerBranch').val();
            model.Province = $('#ddlUpdateProfileSellerProvince').val();
            model.District = $('#ddlUpdateProfileSellerDistrict').val();
            model.SubDistrict = $('#ddlUpdateProfileSellerSubDistrict').val();
            model.Road = $('#txtUpdateProfileSellerRoad').val();
            model.Building = $('#txtUpdateProfileSellerBuilding').val();
            model.Addressnumber = $('#txtUpdateProfileSellerAddressNo').val();
            model.SellerEmail = $('#txtUpdateProfileSellerEmail').val();
            model.EmailTemplateNo = $('#ddlUpdateProfileSellerEmailTemplate').val();
            model.CreateBy = $("#leftSideEmail").text();
            model.CreateDate = new Date();
            model.UpdateBy = $("#leftSideEmail").text();
            model.UpdateDate = new Date();
            model.Isactive = IsActive;

            var getJsonString = JSON.stringify(model);

            $.ajax({
                type: "POST",
                url: "@Url.Action("Update", "ProfileSeller")",
                data: { jsonString : getJsonString },
                dataType: "text",
                success: function (resp) {

                    JSON.parse(resp);

                    if(resp.status = true){

                        fnSweetAlert_SaveSuccess();

                        $("#ddlUpdateProfileSellerCompanyCode").empty();
                        document.getElementById('txtUpdateProfileSellerBranch').value = "";
                        document.getElementById('txtUpdateProfileSellerAddressNo').value = "";
                        document.getElementById('txtUpdateProfileSellerBuilding').value = "";
                        document.getElementById('txtUpdateProfileSellerRoad').value = "";
                        $("#ddlUpdateProfileSellerProvince").empty();
                        $("#ddlUpdateProfileSellerDistrict").empty();
                        $("#ddlUpdateProfileSellerSubDistrict").empty();
                        document.getElementById('txtUpdateProfileSellerEmail').value = "";
                        $("#ddlUpdateProfileSellerEmailTemplate").empty();

                        $("#modalUpdateProfileSeller").modal('hide');
                        callProfileSellerIndex();
                    }
                    else{
                        fnSweetAlert_Error(resp.error_message);
                    }
                }
            });
        }

        function callProfileSellerDeleteController(getPK){

            var model = new Object();


            model.SellerNo = $('#txtUpdateProfileSellerNo').val();
            model.CompanyCode = $('#ddlUpdateProfileSellerCompanyCode').val();
            model.BranchCode = $('#txtUpdateProfileSellerBranch').val();
            model.Province = $('#ddlUpdateProfileSellerProvince').val();
            model.District = $('#ddlUpdateProfileSellerDistrict').val();
            model.SubDistrict = $('#ddlUpdateProfileSellerSubDistrict').val();
            model.Road = $('#txtUpdateProfileSellerRoad').val();
            model.Building = $('#txtUpdateProfileSellerBuilding').val();
            model.Addressnumber = $('#txtUpdateProfileSellerAddressNo').val();
            model.SellerEmail = $('#txtUpdateProfileSellerEmail').val();
            model.EmailTemplateNo = $('#ddlUpdateProfileSellerEmailTemplate').val();
            model.CreateBy = $("#leftSideEmail").text();
            model.CreateDate = new Date();
            model.UpdateBy = $("#leftSideEmail").text();
            model.UpdateDate = new Date();
            model.Isactive = IsActive;

            var getJsonString = JSON.stringify(model);

            $.ajax({
                type: "POST",
                url: "@Url.Action("Delete", "ProfileSeller")",
                data: { jsonString : getJsonString },
                dataType: "text",
                success: function () {

                        fnSweetAlert_DeleteSuccess();

                    }
            });
        }

        function callProfileSellerExportController(){
            $.ajax({
                type: "GET",
                url: "@Url.Action("ExportToCsv", "ProfileSeller")",
                //data: { id : getPK },
                contentType: 'application/json; charset=utf-8',
                //dataType: "json",
                success: function (response) {

                    var blob = new Blob([response], {type: 'text/csv;charset=utf-8;'});

                    var downloadUrl = URL.createObjectURL(blob);

                    var a = document.createElement("a");

                    a.href = downloadUrl;

                    a.download = "scg-etax-ProfileSeller.csv";

                    document.body.appendChild(a);

                    a.click();
                }
            });
        }

        // [end] Ajax call Controller

        function callProfileSellerIndex() {
            setTimeout(function(){
                $.blockUI();
                $("#contentPartial").load("@Url.Action("Index", "ProfileSeller")");
                $.unblockUI();
            }, 500);
        }

</script>