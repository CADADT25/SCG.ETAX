@{
    ViewData["Title"] = " ProfilePartner ";
    Layout = null;
}

@await Html.PartialAsync("~/Views/ProfilePartner/_Content.cshtml")



<script type="text/javascript">

     $(document).ready(function () {

        RenderProfilePartner();

    });

    $(window).on('load', function() {

        $('#modalCreateProfilePartner').select2({
            dropdownParent: $('#modalCreateProfilePartner')
        });


        $('#modalUpdateProfilePartner').select2({
            dropdownParent: $('#modalUpdateProfilePartner')
        });

    });

    function fnDropdownProfilePartnerCompanyCode() {

        $('<option>',
        {
            value: 0,
        }).html("--- Select Company Code ---").appendTo("#ddlInsertProfilePartnerCompanyCode");

        $.getJSON("@Url.Action("DropDownList", "ProfileCustomer")", function (data) {
            console.log(data);
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data,
                        text: data
                    }).html(data).appendTo("#ddlInsertProfilePartnerCompanyCode");

                $('<option>',
                    {
                        value: data,
                        text: data
                    }).html(data.companyCode).appendTo("#ddlUpdateProfilePartnerCompanyCode");
            });
        })

        //$.getJSON("@Url.Action("DropDownList", "ProfileCompany")", function (data) {
        //    $.each(data, function (i, data) {
        //        $('<option>',
        //            {
        //                value: data.companyCode,
        //                text: data.companyCode
        //            }).html(data.companyCode).appendTo("#ddlInsertProfilePartnerCompanyCode");
        //    });
        //})

        //$.getJSON("@Url.Action("DropDownList", "ProfileCompany")", function (data) {
        //    $.each(data, function (i, data) {
        //        $('<option>',
        //            {
        //                value: data.companyCode,
        //                text: data.companyCode
        //            }).html(data.companyCode).appendTo("#ddlUpdateProfilePartnerCompanyCode");
        //    });
        //})
    }

    function fnDropdownProfilePartnerSaleOrg(companyCode) {
        
        $("#ddlInsertProfilePartnerSaleOrg").empty();
        $("#ddlUpdateProfilePartnerSaleOrg").empty();

        $('<option>',
        {
            value: 0,
        }).html("--- Select SaleOrg ---").appendTo("#ddlInsertProfilePartnerSaleOrg");

        $.getJSON("@Url.Action("DropDownList", "ProfileSellOrg")?companyCode="+companyCode+"", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.sellOrgCode,
                        text: data.sellOrgCode
                    }).html(data.sellOrgCode).appendTo("#ddlInsertProfilePartnerSaleOrg");
            });
        })

        $.getJSON("@Url.Action("DropDownList", "ProfileSellOrg")?companyCode="+companyCode+"", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.sellOrgCode,
                        text: data.sellOrgCode
                    }).html(data.sellOrgCode).appendTo("#ddlUpdateProfilePartnerSaleOrg");
            });
        })
    }

    function fnDropdownProfilePartnerEmailType() {

        $('<option>',
        {
            value: 0,
        }).html("--- Select Email Type ---").appendTo("#ddlInsertProfilePartnerEmailType");

        $.getJSON("@Url.Action("DropDownList", "ProfileEmailType")", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.emailTypeNo,
                        text: data.emailTypeName
                    }).html(data.emailTypeName).appendTo("#ddlInsertProfilePartnerEmailType");
            });
        })

        $.getJSON("@Url.Action("DropDownList", "ProfileEmailType")", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.emailTypeNo,
                        text: data.emailTypeName
                    }).html(data.emailTypeName).appendTo("#ddlUpdateProfilePartnerEmailType");
            });
        })
    }


    function fnDropdownProfilePartnerEmailTemplate() {

        $('<option>',
        {
            value: 0,
        }).html("--- Select Email Template ---").appendTo("#ddlInsertProfilePartnerEmailTemplate");

        $.getJSON("@Url.Action("DropDownList", "ProfileEmailTemplate")", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.emailTemplateNo,
                        text: data.emailTemplateName
                    }).html(data.emailTemplateName).appendTo("#ddlInsertProfilePartnerEmailTemplate");
            });
        })

        $.getJSON("@Url.Action("DropDownList", "ProfileEmailTemplate")", function (data) {
            $.each(data, function (i, data) {
                $('<option>',
                    {
                        value: data.emailTemplateNo,
                        text: data.emailTemplateName
                    }).html(data.emailTemplateName).appendTo("#ddlUpdateProfilePartnerEmailTemplate");
            });
        })
    }

    function onChangeDdlUpdatePartnerSaleOrg(){

        $('#ddlUpdateProfilePartnerSaleOrg').empty();

        var getCompanyCode = $('#ddlUpdateProfilePartnerCompanyCode').val();

        fnDropdownProfilePartnerSaleOrg(getCompanyCode);

    }
    function onChangeDdlInsertPartnerSaleOrg(){

        $('#ddlInsertProfilePartnerSaleOrg').empty();

        var getCompanyCode = $('#ddlInsertProfilePartnerCompanyCode').val();

        fnDropdownProfilePartnerSaleOrg(getCompanyCode);

    }

             
    function onChangeInsertProfilePartnerPrint(){

        if(document.getElementById("toggleInsertProfilePartnerPrint").checked){
            $('#grpInsertPartnerNumberOfCopies').removeClass('hidden');
        }else{
            $('#grpInsertPartnerNumberOfCopies').addClass('hidden');
        }
    }

    function onChangeInsertProfilePartnerEmail(){

        if(document.getElementById("toggleInsertProfilePartnerEmail").checked){

            $('#grpInsertPartnerEmail').removeClass('hidden');

        }else{

            $('#grpInsertPartnerEmail').addClass('hidden');

        }

        if(document.getElementById("toggleInsertProfilePartnerEmail").checked){

            $('#grpInsertPartnerCcEmail').removeClass('hidden');
            $('#grpInsertPartnerFileAttach').removeClass('hidden');
            $('#grpInsertPartnerSingedPdf').removeClass('hidden');
            $('#grpInsertPartnerSingedXml').removeClass('hidden');
            $('#grpInsertPartnerEmailType').removeClass('hidden');
            $('#grpInsertPartnerEmailTemplate').removeClass('hidden');

        }else{

            $('#grpInsertPartnerCcEmail').addClass('hidden');
            $('#grpInsertPartnerFileAttach').addClass('hidden');
            $('#grpInsertPartnerSingedPdf').addClass('hidden');
            $('#grpInsertPartnerSingedXml').addClass('hidden');
            $('#grpInsertPartnerEmailType').addClass('hidden');
            $('#grpInsertPartnerEmailTemplate').addClass('hidden');

        }
    }

    function onChangeUpdateProfilePartnerPrint(){

        if(document.getElementById("toggleUpdateProfilePartnerPrint").checked){
            $('#grpUpdatePartnerNumberOfCopies').removeClass('hidden');
        }else{
            $('#grpUpdatePartnerNumberOfCopies').addClass('hidden');
        }
    }


    function onChangeUpdateProfilePartnerEmail(){

        if(document.getElementById("toggleUpdateProfilePartnerEmail").checked){

            $('#grpUpdatePartnerEmail').removeClass('hidden');

        }else{

            $('#grpUpdatePartnerEmail').addClass('hidden');

        }

        if(document.getElementById("toggleUpdateProfilePartnerEmail").checked){

            $('#grpUpdatePartnerEmail').removeClass('hidden');
            $('#grpUpdatePartnerCcEmail').removeClass('hidden');
            $('#grpUpdatePartnerFileAttach').removeClass('hidden');
            $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
            $('#grpUpdatePartnerSingedXml').removeClass('hidden');
            $('#grpUpdatePartnerEmailType').removeClass('hidden');
            $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');

        }else{

            $('#grpUpdatePartnerEmail').addClass('hidden');
            $('#grpUpdatePartnerCcEmail').addClass('hidden');
            $('#grpUpdatePartnerFileAttach').addClass('hidden');
            $('#grpUpdatePartnerSingedPdf').addClass('hidden');
            $('#grpUpdatePartnerSingedXml').addClass('hidden');
            $('#grpUpdatePartnerEmailType').addClass('hidden');
            $('#grpUpdatePartnerEmailTemplate').addClass('hidden');

        }
    }


    function RenderProfilePartner(){
        var table = $('#tbProfilePartnerMain').DataTable();
        table.clear().draw();
        table.destroy();

        var table = $("#tbProfilePartnerMain").DataTable({

            //"scrollY": false,
            "processing": true, 
            "serverSide": false, 
            "filter": true, 
            "orderMulti": true, 
            "pageLength": 10,

            "ajax": {
                url: "@Url.Action("List", "ProfilePartner")",
                type: "POST",
                datatype: "json"
            },


            "columns": [

                {
                    data: "partnerProfileNo",
                    className: "text-center",
                    width: "5%",
                    visible: false
                },
                {
                    className: "text-center",
                    width: "5%",
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "customerId",
                    width: "10%"
                },
                {
                    data: "companyCode",
                    width: "10%"
                },
                {
                    data: "sellOrg",
                    width: "10%"
                },
                {
                    data: "soldToCode",
                    width: "10%"
                },
                {
                    data: "shipToCode",
                    width: "10%"
                },
                {
                    data: "isactive",
                    width: "10%",
                    className: "text-center",
                    render: function (data, type, row) {
                        return (data == 1) ? '<i class="text-success fas fa-check"/>' : '<i class="text-danger fas fa-ban"/>';
                    }
                },
                {
                    data: null,
                    className: "dt-center text-center text-primary",
                    //defaultContent: '<i class="pointer fas fa-pen"/>',
                    createdCell: function (td, cellData, rowData, row, col) {
                      if ('@ViewBag.showUPDATE'.toUpperCase() == 'TRUE') {
                        $(td).addClass('editor-edit');
                      }
                    },
                    render: function (data, type, row) {
                        if ('@ViewBag.showUPDATE'.toUpperCase() == 'TRUE'){
                            return '<i class="pointer fas fa-pen"/>';
                        }
                        return '';
                    },
                    orderable: false,
                    width: "2%"
                }
            ]
        });

        table.on( 'order.dt search.dt', function () {
            table.column(1, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                cell.innerHTML = i+1;
            } );
        } ).draw();


        EditProfilePartner(table);
        //DeleteProfilePartner(table);
    }

    function fnInsertCancelProfilePartner(){
        $("#ddlInsertProfilePartnerCompanyCode").empty();
        $("#ddlInsertProfilePartnerSaleOrg").empty();
        $("#ddlInsertProfilePartnerEmailType").empty();
        $("#ddlInsertProfilePartnerEmailTemplate").empty();
        $("#modalCreateProfilePartner").modal('hide');
    }

    function fnUpdateCancelProfilePartner(){

        $("#ddlUpdateProfilePartnerCompanyCode").empty();
        $("#ddlUpdateProfilePartnerSaleOrg").empty();
        $("#ddlUpdateProfilePartnerEmailType").empty();
        $("#ddlUpdateProfilePartnerEmailTemplate").empty();
        $("#modalUpdateProfilePartner").modal('hide');
    }

    function callModalInsertProfilePartner(){

        $("#ddlInsertProfilePartnerEmailType").empty();
        $("#ddlInsertProfilePartnerEmailTemplate").empty();
        $("#ddlInsertProfilePartnerCompanyCode").empty();
        $("#ddlInsertProfilePartnerSaleOrg").empty();

        fnDropdownProfilePartnerEmailType();
        fnDropdownProfilePartnerEmailTemplate();
        fnDropdownProfilePartnerCompanyCode();
        $("#modalCreateProfilePartner").modal('show');
    }

    function fnInsertProfilePartner(){

        if ( $('#txtInsertProfilePartnerCustomerId').val() != '' ||
             $('#ddlInsertProfilePartnerCompanyCode').val() != '0' )
        {
            callProfilePartnerInsertController();
        }
        else {
            fnToastrInputDataFail();
            validateInsertProfilePartner();
        }

    }

    function fnUpdateProfilePartner(){

         if ( $('#txtUpdateProfilePartnerCustomerId').val() != '' ||
              $('#ddlUpdateProfilePartnerCompanyCode').val() != '' )

        {
            callProfilePartnerUpdateController();
        }
        else {
            fnToastrInputDataFail();
            validateUpdateProfilePartner();
        }
    }

    function EditProfilePartner(table){

        $('#tbProfilePartnerMain').on('click', 'td.editor-edit', function () {

            var data = table.row($(this).closest('tr')).data();

            var getPK = data[Object.keys(data)[0]];

            callProfilePartnerGetDetailController(getPK);

        });
    }



    function ExportProfilePartner(){

        $.blockUI();

        callProfilePartnerExportController();

        $.unblockUI();
    }


    function callProfilePartnerGetDetailController(getPK){

        fnDropdownProfilePartnerEmailType();
        fnDropdownProfilePartnerEmailTemplate();
        fnDropdownProfilePartnerCompanyCode();
            
        $.ajax({
            type: "GET",
            url: "@Url.Action("Detail", "ProfilePartner")",
            data: { id : getPK },
            dataType: "json",
            success: function (result) {

                data = $.parseJSON(result)

                document.getElementById('txtUpdateProfilePartnerNo').value = data.PartnerProfileNo;
                document.getElementById('txtUpdateProfilePartnerCustomerId').value = data.CustomerId;

                //$('#ddlUpdateProfilePartnerCompanyCode').empty() 
                //.append($("<option/>")
                //    .val(""+data.CompanyCode+"")
                //    .text(""+data.CompanyCode+""))
                //.val(""+data.CompanyCode+"")
                //.trigger("change");


                //$('#ddlUpdateProfilePartnerSaleOrg').empty() 
                //.append($("<option/>")
                //    .val(""+data.SellOrg+"")
                //    .text(""+data.SellOrg+""))
                //.val(""+data.SellOrg+"")
                //.trigger("change");


                document.getElementById('txtUpdateProfilePartnerSoldTo').value = data.SoldToCode;
                document.getElementById('txtUpdateProfilePartnerShipTo').value = data.ShipToCode;


                document.getElementById('txtUpdateProfilePartnerNumberOfCopies').value = data.NumberOfCopies;

                var getOutputType = data.PartnerOutputType;

                if(getOutputType == '1'){

                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = true;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').removeClass('hidden');

                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = false;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = false;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = false;

                }else if(getOutputType == '2'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = false;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').addClass('hidden');


                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = false;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');


                }else if(getOutputType == '3'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = false;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').addClass('hidden');


                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = false;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = true;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');

                }else if(getOutputType == '4'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = false;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').addClass('hidden');

                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = true;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');

                }else if(getOutputType == '5'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = true;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').removeClass('hidden');

                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = false;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');

                }else if(getOutputType == '6'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = true;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').removeClass('hidden');

                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = false;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = true;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');

                }else if(getOutputType == '7'){
                    document.getElementById("toggleUpdateProfilePartnerPrint").checked = true;
                    $('#grpUpdatePartnerPartnerNumberOfCopies').removeClass('hidden');

                    document.getElementById("toggleUpdateProfilePartnerEmail").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedPdf").checked = true;
                    document.getElementById("toggleUpdateProfilePartnerFileSignedXml").checked = true;

                    $('#grpUpdatePartnerEmail').removeClass('hidden');
                    $('#grpUpdatePartnerCcEmail').removeClass('hidden');
                    $('#grpUpdatePartnerFileAttach').removeClass('hidden');
                    $('#grpUpdatePartnerSingedPdf').removeClass('hidden');
                    $('#grpUpdatePartnerSingedXml').removeClass('hidden');
                    $('#grpUpdatePartnerEmailType').removeClass('hidden');
                    $('#grpUpdatePartnerEmailTemplate').removeClass('hidden');
                }

                document.getElementById('txtUpdateProfilePartnerCustomerEmail').value = data.SoldToEmail;
                document.getElementById('txtUpdateProfilePartnerCustomerCCEmail').value = data.SoldToCcemail;

                //$('#ddlUpdateProfilePartnerEmailType').empty().append($("<option/>").val(""+data.PartnerEmailType+"").text(""+data.PartnerEmailType+""))
                //.val(""+data.PartnerEmailType+"").trigger("change");

                //$('#ddlUpdateProfilePartnerEmailTemplate').empty().append($("<option/>").val(""+data.EmailTemplateNo+"").text(""+data.EmailTemplateNo+""))
                //.val(""+data.EmailTemplateNo+"").trigger("change");
                setTimeout(function(){                
                    $('#ddlUpdateProfilePartnerCompanyCode').val(data.CompanyCode).trigger('change');
                    $('#ddlUpdateProfilePartnerEmailType').val(data.PartnerEmailType).trigger('change');
                    $('#ddlUpdateProfilePartnerEmailTemplate').val(data.EmailTemplateNo).trigger('change');
                }, 1000);

                setTimeout(function(){   
                    $('#ddlUpdateProfilePartnerSaleOrg').val(data.SellOrg).trigger('change');
                }, 5000);


                if(data.Isactive == 1){
                    document.getElementById("toggleUpdateProfilePartner").checked = true;
                }
                else{
                    document.getElementById("toggleUpdateProfilePartner").checked = false;
                }
                
                setTimeout(function(){   
                    $("#modalUpdateProfilePartner").modal('show');
                }, 1000);
            }
        });

    }

    function callProfilePartnerInsertController(){

        var OutPutType = 1;

        var IsActive = ($('#toggleInsertProfilePartner').prop('checked')) ? 1 : 0 ;
        var StatusPrint = ($('#toggleInsertProfilePartnerPrint').prop('checked')) ? 1 : 0 ;
        var StatusEmail = ($('#toggleInsertProfilePartnerEmail').prop('checked')) ? 1 : 0 ;
        var StatusSignPdf = ($('#toggleInsertProfilePartnerFileSignedPdf').prop('checked')) ? 1 : 0 ;
        var StatusSignxml = ($('#toggleInsertProfilePartnerFileSignedXml').prop('checked')) ? 1 : 0 ;


        if( (StatusPrint == 1) && (StatusEmail == 0) && (StatusSignPdf == 0) && (StatusSignxml == 0)){
            OutPutType = 1;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 0)){
            OutPutType = 2;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 0) && (StatusSignxml == 1)){
            OutPutType = 3;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 1)){
            OutPutType = 4;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 0)){
            OutPutType = 5;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 0) && (StatusSignxml == 1)){
            OutPutType = 6;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 1)){
            OutPutType = 7;
        }


        var model = new Object();

        model.CustomerId = $('#txtInsertProfilePartnerCustomerId').val();
        model.CompanyCode = $('#ddlInsertProfilePartnerCompanyCode').val();
        model.SellOrg = $('#ddlInsertProfilePartnerSaleOrg').val();

        model.SoldToCode = $('#txtInsertProfilePartnerSoldTo').val();
        model.SoldToEmail = $('#txtInsertProfilePartnerCustomerEmail').val();
        model.SoldToCCEmail = $('#txtInsertProfilePartnerCustomerCCEmail').val();

        model.ShipToCode = $('#txtInsertProfilePartnerShipTo').val();
        model.ShipToEmail = $('#txtInsertProfilePartnerCustomerEmail').val();
        model.ShipToCCEmail = $('#txtInsertProfilePartnerCustomerCCEmail').val();


        model.PartnerOutputType = OutPutType;
        model.NumberOfCopies = $('#txtInsertNumberOfCopies').val();
        model.PartnerEmailType = $('#ddlInsertProfilePartnerEmailType').val();
        model.PartnerEmailTemplateNo = $('#ddlInsertProfilePartnerEmailTemplate').val();

        model.StatusPrint = StatusPrint;
        model.StatusEmail = StatusEmail;
        model.StatusSignPdf = StatusSignPdf;
        model.StatusSignXml = StatusSignxml;

        model.CreateBy = $("#leftSideEmail").text();
        model.CreateDate = new Date();
        model.UpdateBy = $("#leftSideEmail").text();
        model.UpdateDate = new Date();
        model.Isactive = IsActive;

        var getJsonString = JSON.stringify(model);

        $.ajax({
            type: "POST",
            url: "@Url.Action("Insert", "ProfilePartner")",
            data: { jsonString : getJsonString },
            dataType: "text",
            success: function (resp) {

                data = $.parseJSON(resp);

                var errorMessage = data.erroR_MESSAGE;

                if(data.status == true){

                    $('#modalCreateProfilePartner').modal('hide');

                    fnSweetAlert_SaveSuccess();

                    callProfilePartnerIndex();

                    $("#Partner-tab").addClass("active");
                    $("#Customer-tab").removeClass("active");
                }
                else{
                    fnSweetAlert_Error(errorMessage);
                }

            }
        });
    }

    function callProfilePartnerUpdateController(){


        var OutPutType = 1;


        var IsActive = ($('#toggleUpdateProfilePartner').prop('checked')) ? 1 : 0 ;
        var StatusPrint = ($('#toggleUpdateProfilePartnerPrint').prop('checked')) ? 1 : 0 ;
        var StatusEmail = ($('#toggleUpdateProfilePartnerEmail').prop('checked')) ? 1 : 0 ;
        var StatusSignPdf = ($('#toggleUpdateProfilePartnerFileSignedPdf').prop('checked')) ? 1 : 0 ;
        var StatusSignxml = ($('#toggleUpdateProfilePartnerFileSignedXml').prop('checked')) ? 1 : 0 ;

        if( (StatusPrint == 1) && (StatusEmail == 0) && (StatusSignPdf == 0) && (StatusSignxml == 0)){
            OutPutType = 1;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 0)){
            OutPutType = 2;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 0) && (StatusSignxml == 1)){
            OutPutType = 3;
        }else if((StatusPrint == 0) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 1)){
            OutPutType = 4;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 0)){
            OutPutType = 5;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 0) && (StatusSignxml == 1)){
            OutPutType = 6;
        }else if((StatusPrint == 1) && (StatusEmail == 1) && (StatusSignPdf == 1) && (StatusSignxml == 1)){
            OutPutType = 7;
        }


        var model = new Object();

        model.PartnerProfileNo = $('#txtUpdateProfilePartnerNo').val();
        model.CustomerId = $('#txtUpdateProfilePartnerCustomerId').val();
        model.CompanyCode = $('#ddlUpdateProfilePartnerCompanyCode').val();
        model.SellOrg = $('#ddlUpdateProfilePartnerSaleOrg').val();

        model.SoldToCode = $('#txtUpdateProfilePartnerSoldTo').val();
        model.SoldToEmail = $('#txtUpdateProfilePartnerCustomerEmail').val();
        model.SoldToCCEmail = $('#txtUpdateProfilePartnerCustomerCCEmail').val();

        model.ShipToCode = $('#txtUpdateProfilePartnerShipTo').val();
        model.ShipToEmail = $('#txtUpdateProfilePartnerCustomerEmail').val();
        model.ShipToCCEmail = $('#txtUpdateProfilePartnerCustomerCCEmail').val();


        model.PartnerOutputType = OutPutType;
        model.NumberOfCopies = $('#txtUpdateNumberOfCopies').val();
        model.PartnerEmailType = $('#ddlUpdateProfilePartnerEmailType').val();
        model.PartnerEmailTemplateNo = $('#ddlUpdateProfilePartnerEmailTemplate').val();

        model.StatusPrint = StatusPrint;
        model.StatusEmail = StatusEmail;
        model.StatusSignPdf = StatusSignPdf;
        model.StatusSignXml = StatusSignxml;

        model.CreateBy = $("#leftSideEmail").text();
        model.CreateDate = new Date();
        model.UpdateBy = $("#leftSideEmail").text();
        model.UpdateDate = new Date();
        model.Isactive = IsActive;

        var getJsonString = JSON.stringify(model);

        $.ajax({
            type: "POST",
            url: "@Url.Action("Update", "ProfilePartner")",
            data: { jsonString : getJsonString },
            dataType: "text",
            success: function (resp) {

                data = $.parseJSON(resp)

                var errorMessage = data.erroR_MESSAGE;

                if(data.status == true){

                    $('#modalUpdateProfilePartner').modal('hide');

                    fnSweetAlert_SaveSuccess();

                    callProfilePartnerIndex();

                    $("#Partner-tab").addClass("active");
                    $("#Customer-tab").removeClass("active");

                }
                else{
                    fnSweetAlert_Error(errorMessage);
                }
            }
        });
    }

    function callProfilePartnerDeleteController(getPK){

        var model = new Object();


        model.SellOrgNo = getPK;
        model.SellOrgCode = "";
        model.SellOrgDescripttion = "";
        model.CreateBy = $("#leftSideEmail").text();
        model.CreateDate = new Date();
        model.UpdateBy = $("#leftSideEmail").text();
        model.UpdateDate = new Date();
        model.Isactive = 0;

        var getJsonString = JSON.stringify(model);

        $.ajax({
            type: "POST",
            url: "@Url.Action("Delete", "ProfilePartner")",
            data: { jsonString : getJsonString },
            //contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function () {
                    fnSweetAlert_DeleteSuccess();
                }
        });
    }

    function callProfilePartnerExportController(){
        $.ajax({
            type: "GET",
            url: "@Url.Action("ExportToCsv", "ProfilePartner")",
            //data: { id : getPK },
            contentType: 'application/json; charset=utf-8',
            //dataType: "json",
            success: function (response) {

                var blob = new Blob([response], {type: 'text/csv;charset=utf-8;'});

                var downloadUrl = URL.createObjectURL(blob);

                var a = document.createElement("a");

                a.href = downloadUrl;

                a.download = "scg-etax-ProfilePartner.csv";

                document.body.appendChild(a);

                a.click();
            }
        });
    }

    // [end] Ajax call Controller




    function callProfilePartnerIndex() {
        setTimeout(function(){
            $.blockUI();
            $("#contentPartial").load("@Url.Action("Index", "ManagementCustomerProfile")");
            $.unblockUI();
        }, 500);

        
    }



    function ImportProfilePartner(){
        $("#inputFileImportPartner").click();
    }

    $("#inputFileImportPartner").on("change", function (e) {
        var file = e.target.files[0];
        // input canceled, return
        if (!file) return;
        var filedata = $("#inputFileImportPartner").val().replace(/C:\\fakepath\\/i, '');
        var chkcsv = filedata.split('.');
        if(chkcsv[chkcsv.length - 1] != "csv" && chkcsv[chkcsv.length - 1] != "CSV"){
           var FR = new FileReader();
            FR.onload = function(e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, {type: 'array'});
                var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                var result = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                fnUploadProfilePartner(result, false);
                $("#inputFileImportPartner").val("");
            };
            FR.readAsArrayBuffer(file);
        }else{
            var FR = new FileReader();

            FR.onload = function (e) {
                const text = e.target.result;
                const data = csvToArray(text);
                //document.write(JSON.stringify(data));
                fnUploadProfilePartner(data, true);
                $("#inputFileImportPartner").val("");
            };

            FR.readAsText(file);
        }
        
    });


    function fnUploadProfilePartner(data, iscsv){
        if(data==null){
            fnAlertValidate("Data not found in file.");
        }
        else if(data.length<=1){
            fnAlertValidate("Data not found in file.");
        }else{
            var datas = [];
            if(iscsv){
                for(var i = 0; i < data.length; i++){
                    if(data[i] != undefined){
                        var model = new Object();
                        model.PartnerProfileNo = data[i].PartnerProfileNo;
                        model.CustomerId = data[i].CustomerId;
                        model.CompanyCode = data[i].CompanyCode;
                        model.SellOrg = data[i].SellOrg;
                        model.PartnerOutputType = data[i].PartnerOutputType;
                        model.NumberOfCopies = data[i].NumberOfCopies;
                        model.SoldToCode = data[i].SoldToCode;
                        model.SoldToEmail = data[i].SoldToEmail;
                        model.SoldToCcemail = data[i].SoldToCcemail;
                        model.ShipToCode = data[i].ShipToCode;
                        model.ShipToEmail = data[i].ShipToEmail;
                        model.ShipToCcemail = data[i].ShipToCcemail;
                        model.PartnerEmailType = data[i].PartnerEmailType;
                        model.EmailTemplateNo = data[i].EmailTemplateNo;
                        model.StatusPrint = data[i].StatusPrint;
                        model.StatusEmail = data[i].StatusEmail;
                        model.StatusSignPdf = data[i].StatusSignPdf;
                        model.StatusSignXml = data[i].StatusSignXml;
                        model.Isactive = data[i].Isactive;
                        model.CreateBy = null;
                        model.CreateDate = null;
                        model.UpdateBy = null;
                        model.UpdateDate = null;
                        datas.push(model);
                    }
                }
            }else{
                for(var i = 1; i < data.length; i++){
                    var model = new Object();
                    model.PartnerProfileNo = data[i][0];
                    model.CustomerId = data[i][1];
                    model.CompanyCode = data[i][2];
                    model.SellOrg = data[i][3];
                    model.PartnerOutputType = data[i][4];
                    model.NumberOfCopies = data[i][5];
                    model.SoldToCode = data[i][6];
                    model.SoldToEmail = data[i][7];
                    model.SoldToCcemail = data[i][8];
                    model.ShipToCode = data[i][9];
                    model.ShipToEmail = data[i][10];
                    model.ShipToCcemail = data[i][11];
                    model.PartnerEmailType = data[i][12];
                    model.EmailTemplateNo = data[i][13];
                    model.StatusPrint = data[i][14];
                    model.StatusEmail = data[i][15];
                    model.StatusSignPdf = data[i][16];
                    model.StatusSignXml = data[i][17];
                    model.Isactive = data[i][18];
                    model.CreateBy = null;
                    model.CreateDate = null;
                    model.UpdateBy = null;
                    model.UpdateDate = null;
                    datas.push(model);
                }
            }
            
            
            Swal.fire({
                title: 'Are you sure to import?',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes',
                confirmButtonClass: 'btn btn-primary',
                cancelButtonClass: 'btn btn-danger ml-1',
                buttonsStyling: false,
            }).then(function (result) {
                if (result.isConfirmed) {
                    $.blockUI();
                    var getJsonString = JSON.stringify(datas);
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("Import", "ProfilePartner")",
                        data: { jsonString: getJsonString },
                        dataType: "text",
                        success: function (res) {
                            
                            var ret = $.parseJSON(res);
                            if (ret.status) {
                                fnSweetAlert_Success();
                                RenderProfilePartner();
                            }
                            else {
                                fnSweetAlert_Error(ret.erroR_MESSAGE);
                            }
                            $.unblockUI();
                        }
                    });
                }
            });
        }
        
    }



</script>